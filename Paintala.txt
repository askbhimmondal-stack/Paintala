<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Color Palette Extractor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    /* ============================================================
       CSS CUSTOM PROPERTIES
       Color palette: deep navy base, vivid teal primary,
       warm coral/orange secondary â€” tuned to logo aesthetic.
       Dynamic theming applied via JS after logo loads.
    ============================================================ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-base:      #07090f;
      --glass-bg:     rgba(255,255,255,0.04);
      --glass-border: rgba(255,255,255,0.08);
      --text-primary: #eef2ff;
      --text-muted:   #6a7591;

      /* Default accents â€” overwritten by logo extraction */
      --accent-a:     #00c2a8;
      --accent-b:     #ff6b35;
      --accent-c:     #3d8bff;

      --grad-main:   linear-gradient(135deg, var(--accent-a), var(--accent-b));
      --grad-hero:   linear-gradient(135deg, #eef2ff 15%, var(--accent-a) 55%, var(--accent-b));
      --grad-subtle: linear-gradient(135deg, rgba(0,194,168,.13), rgba(255,107,53,.09));

      --radius-lg: 20px;
      --radius-md: 14px;
      --radius-sm: 9px;
      --shadow:    0 8px 42px rgba(0,0,0,.62);
      --transition: all .25s cubic-bezier(.4,0,.2,1);
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Syne', sans-serif;
      background: var(--bg-base);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* â”€â”€ Animated background mesh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .bg-mesh {
      position: fixed; inset: 0; z-index: 0;
      pointer-events: none; overflow: hidden;
    }
    .bg-mesh span {
      position: absolute; border-radius: 50%;
      filter: blur(110px); opacity: .13;
      animation: drift 14s ease-in-out infinite alternate;
    }
    .bg-mesh span:nth-child(1) {
      width: 700px; height: 700px; background: var(--accent-a);
      top: -260px; left: -180px; animation-delay: 0s;
    }
    .bg-mesh span:nth-child(2) {
      width: 550px; height: 550px; background: var(--accent-b);
      bottom: -200px; right: -120px; animation-delay: -5s;
    }
    .bg-mesh span:nth-child(3) {
      width: 450px; height: 450px; background: var(--accent-c);
      top: 42%; left: 52%; transform: translate(-50%,-50%);
      animation-delay: -9s;
    }
    @keyframes drift {
      from { transform: translate(0,0) scale(1); }
      to   { transform: translate(45px,35px) scale(1.1); }
    }

    /* â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .navbar {
      position: relative; z-index: 10;
      display: flex; align-items: center;
      padding: 16px 40px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      background: rgba(7,9,15,.78);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
    }
    .navbar-logo { display: flex; align-items: center; text-decoration: none; }
    .navbar-logo img {
      height: 40px; width: auto; object-fit: contain;
      filter: drop-shadow(0 0 12px rgba(0,194,168,.28));
      transition: var(--transition);
    }
    .navbar-logo img:hover {
      filter: drop-shadow(0 0 20px rgba(0,194,168,.55));
      transform: scale(1.04);
    }
    .nav-sep {
      width: 1px; height: 24px;
      background: rgba(255,255,255,.1);
      margin: 0 16px;
    }
    .nav-label {
      font-family: 'DM Mono', monospace;
      font-size: .7rem; letter-spacing: .12em; text-transform: uppercase;
      color: var(--text-muted);
    }

    /* â”€â”€ Layout wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .wrapper {
      position: relative; z-index: 1;
      max-width: 1300px; margin: 0 auto;
      padding: 52px 24px 90px;
    }

    /* â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero { text-align: center; margin-bottom: 60px; }
    .hero-badge {
      display: inline-flex; align-items: center; gap: 8px;
      font-family: 'DM Mono', monospace;
      font-size: .7rem; letter-spacing: .14em; text-transform: uppercase;
      color: var(--accent-a);
      border: 1px solid rgba(0,194,168,.3);
      background: rgba(0,194,168,.07);
      padding: 5px 15px; border-radius: 20px; margin-bottom: 22px;
    }
    .hero-badge::before {
      content: ''; width: 6px; height: 6px;
      background: var(--accent-a); border-radius: 50%;
      box-shadow: 0 0 8px var(--accent-a);
    }
    .hero h1 {
      font-size: clamp(2.2rem, 5vw, 4.2rem);
      font-weight: 800; line-height: 1.08; letter-spacing: -.03em;
      background: var(--grad-hero);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; margin-bottom: 18px;
    }
    .hero p {
      font-size: 1.05rem; color: var(--text-muted);
      max-width: 520px; margin: 0 auto; line-height: 1.65;
    }

    /* â”€â”€ Two-panel grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .panel-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 22px; align-items: start;
    }
    @media(max-width:900px) {
      .panel-grid { grid-template-columns: 1fr; }
      .navbar { padding: 14px 20px; }
    }

    /* â”€â”€ Glass card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .glass-card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(22px);
      -webkit-backdrop-filter: blur(22px);
      box-shadow: var(--shadow);
    }

    /* â”€â”€ Left panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .panel-left { padding: 28px; }

    .drop-zone {
      position: relative;
      border: 2px dashed rgba(0,194,168,.28);
      border-radius: var(--radius-md);
      background: rgba(0,194,168,.03);
      min-height: 260px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      cursor: pointer; transition: var(--transition);
      overflow: hidden; margin-bottom: 26px;
    }
    .drop-zone:hover, .drop-zone.drag-over {
      border-color: var(--accent-a);
      background: rgba(0,194,168,.07);
      box-shadow: 0 0 36px rgba(0,194,168,.18);
    }
    .drop-zone input[type="file"] {
      position: absolute; inset: 0;
      opacity: 0; cursor: pointer; width: 100%; height: 100%;
    }
    .drop-icon {
      width: 56px; height: 56px;
      background: var(--grad-main); border-radius: 16px;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 16px;
      box-shadow: 0 4px 24px rgba(0,194,168,.38);
    }
    .drop-icon svg { width: 26px; height: 26px; stroke: #fff; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    .drop-text { font-size: .93rem; color: var(--text-muted); text-align: center; line-height: 1.6; }
    .drop-text strong { display: block; color: var(--text-primary); font-size: 1rem; margin-bottom: 3px; }

    #preview-img {
      display: none; width: 100%; height: 100%;
      object-fit: cover; position: absolute; inset: 0;
      border-radius: calc(var(--radius-md) - 2px);
    }
    .drop-zone.has-image .drop-content { display: none; }
    .drop-zone.has-image #preview-img { display: block; }

    .img-overlay {
      display: none; position: absolute; bottom: 10px; right: 10px;
      background: rgba(7,9,15,.72);
      border: 1px solid rgba(0,194,168,.3); border-radius: 8px;
      padding: 5px 12px; font-family: 'DM Mono', monospace;
      font-size: .72rem; color: var(--accent-a);
      cursor: pointer; transition: var(--transition); z-index: 2; gap: 5px;
    }
    .drop-zone.has-image .img-overlay { display: flex; align-items: center; }
    .img-overlay:hover { background: rgba(0,194,168,.18); }

    /* Controls */
    .controls-section { display: flex; flex-direction: column; gap: 22px; }

    .control-group label {
      display: block; font-size: .7rem; letter-spacing: .1em;
      text-transform: uppercase; color: var(--text-muted); margin-bottom: 11px;
    }
    .control-group label span {
      color: var(--accent-a); font-family: 'DM Mono', monospace;
      font-size: .88rem; letter-spacing: 0; text-transform: none; font-weight: 500;
    }

    input[type="range"] {
      -webkit-appearance: none; width: 100%; height: 4px;
      background: linear-gradient(
        to right, var(--accent-a) 0%, var(--accent-a) var(--pct,50%),
        rgba(255,255,255,.1) var(--pct,50%)
      );
      border-radius: 2px; outline: none; cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 20px; height: 20px;
      background: #fff; border-radius: 50%;
      box-shadow: 0 0 0 4px rgba(0,194,168,.35);
      cursor: pointer; transition: box-shadow .2s;
    }
    input[type="range"]::-webkit-slider-thumb:hover {
      box-shadow: 0 0 0 7px rgba(0,194,168,.28);
    }

    .format-btns { display: flex; gap: 9px; }
    .fmt-btn {
      flex: 1; font-family: 'DM Mono', monospace;
      font-size: .84rem; letter-spacing: .06em; padding: 10px 0;
      background: rgba(255,255,255,.05);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-muted); cursor: pointer; transition: var(--transition);
    }
    .fmt-btn:hover { background: rgba(255,255,255,.09); color: var(--text-primary); }
    .fmt-btn.active {
      background: rgba(0,194,168,.11);
      border-color: rgba(0,194,168,.48);
      color: var(--accent-a);
    }

    .btn-extract {
      width: 100%; padding: 14px;
      background: var(--grad-main);
      border: none; border-radius: var(--radius-md); color: #fff;
      font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 700;
      cursor: pointer; letter-spacing: .02em;
      box-shadow: 0 4px 28px rgba(0,194,168,.38);
      transition: var(--transition);
      display: flex; align-items: center; justify-content: center; gap: 9px;
    }
    .btn-extract:hover { transform: translateY(-2px); box-shadow: 0 10px 36px rgba(0,194,168,.52); }
    .btn-extract:active { transform: translateY(0); }
    .btn-extract svg { width: 18px; height: 18px; stroke: #fff; fill: none; stroke-width: 2.2; stroke-linecap: round; }

    /* â”€â”€ Right panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .panel-right { padding: 28px; }
    .panel-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 22px;
    }
    .panel-title { font-size: 1rem; font-weight: 700; }
    .color-count-badge {
      font-family: 'DM Mono', monospace; font-size: .74rem;
      color: var(--accent-a);
      background: rgba(0,194,168,.09);
      border: 1px solid rgba(0,194,168,.24);
      border-radius: 20px; padding: 3px 11px;
    }

    .empty-state {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 64px 20px; color: var(--text-muted);
      text-align: center; gap: 14px;
    }
    .empty-state svg { opacity: .18; }
    .empty-state p { font-size: .9rem; line-height: 1.55; }

    .palette-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(138px,1fr));
      gap: 14px;
    }

    /* Color card */
    .color-card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-md);
      overflow: hidden; cursor: pointer;
      transition: var(--transition);
      animation: fadeUp .38s ease both;
    }
    @keyframes fadeUp {
      from { opacity:0; transform:translateY(14px); }
      to   { opacity:1; transform:translateY(0); }
    }
    .color-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255,255,255,.15);
      box-shadow: 0 14px 36px rgba(0,0,0,.45);
    }
    .color-swatch { width: 100%; height: 92px; position: relative; }
    .copy-hint {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background: rgba(0,0,0,.28);
      opacity: 0; transition: opacity .2s;
      font-size: .68rem; letter-spacing: .12em; text-transform: uppercase; font-weight: 700;
    }
    .color-card:hover .copy-hint { opacity: 1; }
    .color-card.copied .copy-hint { opacity: 1; background: rgba(0,0,0,.48); }
    .copy-hint-text::after { content: "Click to copy"; }
    .color-card.copied .copy-hint-text::after { content: "âœ“  Copied!"; }

    .color-info { padding: 11px 13px 13px; }
    .color-hex {
      font-family: 'DM Mono', monospace; font-size: .86rem;
      font-weight: 500; color: var(--text-primary); margin-bottom: 3px;
    }
    .color-secondary {
      font-family: 'DM Mono', monospace; font-size: .7rem;
      color: var(--text-muted); line-height: 1.45;
    }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: fixed; bottom: 28px; left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: rgba(7,9,15,.92);
      border: 1px solid rgba(0,194,168,.3);
      backdrop-filter: blur(20px);
      color: var(--accent-a); font-family: 'DM Mono', monospace;
      font-size: .82rem; padding: 10px 24px; border-radius: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,.55), 0 0 30px rgba(0,194,168,.15);
      opacity: 0; pointer-events: none;
      transition: opacity .3s, transform .3s; z-index: 999; white-space: nowrap;
    }
    #toast.show { opacity:1; transform: translateX(-50%) translateY(0); }

    #extract-canvas, #logo-canvas { display: none; }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-base); }
    ::-webkit-scrollbar-thumb { background: rgba(0,194,168,.28); border-radius: 3px; }

    .footer {
      text-align: center; margin-top: 64px;
      font-size: .73rem; color: rgba(106,117,145,.42);
      font-family: 'DM Mono', monospace; letter-spacing: .03em;
    }
    .footer span { color: rgba(0,194,168,.45); }
  </style>
</head>
<body>

<div class="bg-mesh" aria-hidden="true"><span></span><span></span><span></span></div>
<canvas id="extract-canvas"></canvas>
<canvas id="logo-canvas"></canvas>

<!-- â”€â”€ NAVBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<nav class="navbar">
  <a class="navbar-logo" href="#" aria-label="Home">
    <img src="https://i.ibb.co/tpVG2Zz5/image.png" alt="Logo" id="logo-img" crossorigin="anonymous"/>
  </a>
  <div class="nav-sep"></div>
  <span class="nav-label">Color Palette Extractor</span>
</nav>

<!-- â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="wrapper">

  <header class="hero">
    <div class="hero-badge">âœ¦ Canvas-Powered Tool</div>
    <h1>Extract Colors From<br>Any Image</h1>
    <p>Upload or drag an image and generate a clean color palette instantly.</p>
  </header>

  <div class="panel-grid">

    <!-- LEFT PANEL -->
    <div class="glass-card panel-left">
      <div class="drop-zone" id="drop-zone" role="button" aria-label="Upload image">
        <input type="file" id="file-input" accept="image/*" aria-label="Upload image file"/>
        <img id="preview-img" alt="Uploaded preview"/>
        <div class="drop-content" style="display:flex;flex-direction:column;align-items:center;">
          <div class="drop-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          </div>
          <div class="drop-text">
            <strong>Drop your image here</strong>
            or click to browse &middot; paste with Ctrl+V
          </div>
        </div>
        <div class="img-overlay" id="change-img-btn" role="button" tabindex="0" aria-label="Change image">
          <svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4z"/></svg>
          Change image
        </div>
      </div>

      <div class="controls-section">
        <div class="control-group">
          <label>Number of Colors &mdash; <span id="color-count-label">6</span></label>
          <input type="range" id="color-slider" min="3" max="12" value="6" aria-label="Number of colors"/>
        </div>
        <div class="control-group">
          <label>Color Format</label>
          <div class="format-btns" role="group">
            <button class="fmt-btn active" data-fmt="hex" aria-pressed="true">HEX</button>
            <button class="fmt-btn" data-fmt="rgb" aria-pressed="false">RGB</button>
            <button class="fmt-btn" data-fmt="hsl" aria-pressed="false">HSL</button>
          </div>
        </div>
        <button class="btn-extract" id="extract-btn">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 010 14.14M4.93 4.93a10 10 0 000 14.14"/></svg>
          Re-extract Colors
        </button>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="glass-card panel-right">
      <div class="panel-header">
        <span class="panel-title">Generated Palette</span>
        <span class="color-count-badge" id="palette-badge">0 colors</span>
      </div>
      <div class="empty-state" id="empty-state">
        <svg width="66" height="66" fill="none" stroke="currentColor" stroke-width="1.1" viewBox="0 0 24 24">
          <rect x="3" y="3" width="18" height="18" rx="3"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <polyline points="21 15 16 10 5 21"/>
        </svg>
        <p>Upload an image on the left<br/>to generate your color palette.</p>
      </div>
      <div class="palette-grid" id="palette-grid" style="display:none;"></div>
    </div>

  </div>

  <footer class="footer">
    Color Palette Extractor &mdash; <span>Canvas-based</span> &middot; No uploads &middot; Runs entirely in your browser
    <br/><br/>Made in ðŸ’– for Pooja
  </footer>
</div>

<div id="toast" role="status" aria-live="polite"></div>

<script>
/* ================================================================
   COLOR PALETTE EXTRACTOR â€” Core JS
   K-means++ clustering for accurate palette extraction.
   Dynamic logo-driven theming via canvas pixel analysis.
================================================================ */

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentFormat = 'hex';
let loadedImage   = null;
let palette       = [];

// â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const dropZone      = document.getElementById('drop-zone');
const fileInput     = document.getElementById('file-input');
const previewImg    = document.getElementById('preview-img');
const changeImgBtn  = document.getElementById('change-img-btn');
const colorSlider   = document.getElementById('color-slider');
const colorCountLbl = document.getElementById('color-count-label');
const formatBtns    = document.querySelectorAll('.fmt-btn');
const extractBtn    = document.getElementById('extract-btn');
const paletteGrid   = document.getElementById('palette-grid');
const emptyState    = document.getElementById('empty-state');
const paletteBadge  = document.getElementById('palette-badge');
const canvas        = document.getElementById('extract-canvas');
const ctx           = canvas.getContext('2d');
const toastEl       = document.getElementById('toast');

/* ----------------------------------------------------------------
   DYNAMIC LOGO THEMING
   Draws the logo to an offscreen canvas, samples vivid pixels,
   runs a quick k-means to find dominant colors, then applies
   them as CSS custom properties throughout the page.
---------------------------------------------------------------- */
(function applyLogoTheme() {
  const logoImg    = document.getElementById('logo-img');
  const logoCanvas = document.getElementById('logo-canvas');
  const logoCtx    = logoCanvas.getContext('2d');

  function saturation({r,g,b}) {
    const max = Math.max(r,g,b), min = Math.min(r,g,b);
    return max === 0 ? 0 : (max - min) / max;
  }

  function applyTheme(img) {
    try {
      /* Draw logo at 100Ã—100 for fast processing */
      logoCanvas.width = 100; logoCanvas.height = 100;
      logoCtx.drawImage(img, 0, 0, 100, 100);
      const data = logoCtx.getImageData(0, 0, 100, 100).data;

      /* Collect colorful, opaque pixels */
      const samples = [];
      for (let i = 0; i < data.length; i += 4) {
        const r = data[i], g = data[i+1], b = data[i+2], a = data[i+3];
        if (a < 120) continue;
        const lum = (r+g+b)/3;
        if (lum > 230 || lum < 18) continue; // skip near-white & near-black
        samples.push({r,g,b});
      }
      if (samples.length < 30) return; // fallback to defaults

      /* Quick 3-cluster k-means to find dominant colors */
      const colors = kmeans(samples, 3, 10);
      /* Sort by saturation (most vivid first) */
      colors.sort((a,b) => saturation(b) - saturation(a));

      const c1 = colors[0];
      const c2 = colors[1] || colors[0];
      const hex1 = rgbToHex(c1);
      const hex2 = rgbToHex(c2);

      /* Apply dynamic CSS variables */
      const root = document.documentElement;
      root.style.setProperty('--accent-a', hex1);
      root.style.setProperty('--accent-b', hex2);
      root.style.setProperty('--grad-main',
        `linear-gradient(135deg, ${hex1}, ${hex2})`);
      root.style.setProperty('--grad-hero',
        `linear-gradient(135deg, #eef2ff 15%, ${hex1} 55%, ${hex2})`);
      root.style.setProperty('--grad-subtle',
        `linear-gradient(135deg, ${hex1}20, ${hex2}15)`);

      /* Update logo drop-shadow glow to match */
      const logoEl = document.getElementById('logo-img');
      logoEl.style.filter = `drop-shadow(0 0 12px ${hex1}50)`;

      /* Re-color active badge / toast borders dynamically */
      const styleTag = document.createElement('style');
      styleTag.textContent = `
        .hero-badge { color: ${hex1}; border-color: ${hex1}50; background: ${hex1}10; }
        .hero-badge::before { background: ${hex1}; box-shadow: 0 0 8px ${hex1}; }
        .fmt-btn.active { background: ${hex1}18; border-color: ${hex1}80; color: ${hex1}; }
        .btn-extract { box-shadow: 0 4px 28px ${hex1}40; }
        .btn-extract:hover { box-shadow: 0 10px 36px ${hex1}55; }
        .color-count-badge { color: ${hex1}; background: ${hex1}14; border-color: ${hex1}38; }
        #toast { border-color: ${hex1}44; color: ${hex1}; }
        input[type="range"]::-webkit-slider-thumb { box-shadow: 0 0 0 4px ${hex1}55; }
        .img-overlay { border-color: ${hex1}44; color: ${hex1}; }
        .drop-zone { border-color: ${hex1}44; }
        .drop-zone:hover { border-color: ${hex1}; box-shadow: 0 0 36px ${hex1}25; }
        .drop-icon { box-shadow: 0 4px 24px ${hex1}40; }
        ::-webkit-scrollbar-thumb { background: ${hex1}40; }
        .footer span { color: ${hex1}55; }
      `;
      document.head.appendChild(styleTag);

    } catch(e) {
      /* CORS restriction â€” keep defaults silently */
    }
  }

  if (logoImg.complete && logoImg.naturalWidth > 0) {
    applyTheme(logoImg);
  } else {
    logoImg.addEventListener('load', () => applyTheme(logoImg));
    logoImg.addEventListener('error', () => {}); // silent fallback
  }
})();

/* ----------------------------------------------------------------
   TOAST UTILITY
---------------------------------------------------------------- */
let toastTimer;
function showToast(msg) {
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toastEl.classList.remove('show'), 2200);
}

/* ----------------------------------------------------------------
   COLOR CONVERSIONS
---------------------------------------------------------------- */
function rgbToHex({r,g,b}) {
  return '#' + [r,g,b].map(v => v.toString(16).padStart(2,'0')).join('').toUpperCase();
}

function rgbToHsl({r,g,b}) {
  const rr=r/255, gg=g/255, bb=b/255;
  const max=Math.max(rr,gg,bb), min=Math.min(rr,gg,bb);
  let h, s, l=(max+min)/2;
  if(max===min) { h=s=0; }
  else {
    const d=max-min;
    s = l>.5 ? d/(2-max-min) : d/(max+min);
    switch(max){
      case rr: h=((gg-bb)/d+(gg<bb?6:0))/6; break;
      case gg: h=((bb-rr)/d+2)/6; break;
      default: h=((rr-gg)/d+4)/6;
    }
  }
  return `hsl(${Math.round(h*360)}, ${Math.round(s*100)}%, ${Math.round(l*100)}%)`;
}

function formatColor(rgb, fmt) {
  if(fmt==='hex') return rgbToHex(rgb);
  if(fmt==='rgb') return `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
  return rgbToHsl(rgb);
}

function secondaryValue(rgb) {
  return currentFormat==='rgb'
    ? rgbToHsl(rgb)
    : `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
}

function luminance({r,g,b}) {
  return (0.299*r + 0.587*g + 0.114*b) / 255;
}

/* ----------------------------------------------------------------
   IMAGE LOADING
---------------------------------------------------------------- */
function loadImageFile(file) {
  if(!file || !file.type.startsWith('image/')) {
    showToast('Please upload a valid image file.');
    return;
  }
  const reader = new FileReader();
  reader.onload = e => {
    const img = new Image();
    img.onload = () => {
      loadedImage = img;
      previewImg.src = e.target.result;
      dropZone.classList.add('has-image');
      extractPalette();
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

/* ----------------------------------------------------------------
   PIXEL SAMPLING â€” downscales image to canvas for fast processing
---------------------------------------------------------------- */
function samplePixels(img, maxSamples=8000) {
  const size  = Math.min(img.width, img.height, 300);
  const ratio = size / Math.max(img.width, img.height);
  canvas.width  = Math.round(img.width  * ratio);
  canvas.height = Math.round(img.height * ratio);
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

  const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
  const pixels = [];
  const step = Math.max(1, Math.floor(data.length / 4 / maxSamples));

  for(let i=0; i<data.length; i+=step*4) {
    if(data[i+3] < 128) continue; // skip transparent
    pixels.push({r:data[i], g:data[i+1], b:data[i+2]});
  }
  return pixels;
}

/* ----------------------------------------------------------------
   K-MEANS++ CLUSTERING
---------------------------------------------------------------- */
function dist2(a,b) { return (a.r-b.r)**2 + (a.g-b.g)**2 + (a.b-b.b)**2; }

function kmeansInit(pixels, k) {
  const c = [{...pixels[Math.floor(Math.random()*pixels.length)]}];
  for(let i=1; i<k; i++) {
    const dists = pixels.map(p => Math.min(...c.map(cc => dist2(p,cc))));
    const total = dists.reduce((a,b)=>a+b, 0);
    let r = Math.random() * total;
    for(let j=0; j<dists.length; j++) {
      r -= dists[j];
      if(r<=0) { c.push({...pixels[j]}); break; }
    }
  }
  return c;
}

function kmeans(pixels, k, iterations=12) {
  let centroids = kmeansInit(pixels, k);
  for(let iter=0; iter<iterations; iter++) {
    const clusters = Array.from({length:k}, ()=>[]);
    for(const p of pixels) {
      let minD=Infinity, best=0;
      for(let ci=0; ci<k; ci++) {
        const d=dist2(p,centroids[ci]);
        if(d<minD) { minD=d; best=ci; }
      }
      clusters[best].push(p);
    }
    let changed=false;
    for(let ci=0; ci<k; ci++) {
      if(!clusters[ci].length) continue;
      const sum = clusters[ci].reduce(
        (acc,p) => ({r:acc.r+p.r, g:acc.g+p.g, b:acc.b+p.b}),
        {r:0,g:0,b:0}
      );
      const n = clusters[ci].length;
      const nc = {r:Math.round(sum.r/n), g:Math.round(sum.g/n), b:Math.round(sum.b/n)};
      if(dist2(nc,centroids[ci])>1) changed=true;
      centroids[ci]=nc;
    }
    if(!changed) break;
  }
  return centroids;
}

function sortPalette(colors) {
  return [...colors].sort((a,b) => luminance(a)-luminance(b));
}

/* ----------------------------------------------------------------
   EXTRACT + RENDER PALETTE
---------------------------------------------------------------- */
function extractPalette() {
  if(!loadedImage) { showToast('Please upload an image first.'); return; }
  const k = parseInt(colorSlider.value, 10);
  const pixels = samplePixels(loadedImage);
  if(pixels.length < k) { showToast('Image too small to extract colors.'); return; }
  requestAnimationFrame(() => {
    palette = sortPalette(kmeans(pixels, k));
    renderPalette();
  });
}

function renderPalette() {
  paletteGrid.innerHTML = '';
  emptyState.style.display = 'none';
  paletteGrid.style.display = 'grid';
  paletteBadge.textContent = `${palette.length} color${palette.length!==1?'s':''}`;

  palette.forEach((rgb, idx) => {
    const hex  = rgbToHex(rgb);
    const main = formatColor(rgb, currentFormat);
    const sec  = secondaryValue(rgb);
    const lum  = luminance(rgb);
    const txtColor = lum > .55 ? 'rgba(0,0,0,.75)' : 'rgba(255,255,255,.9)';

    const card = document.createElement('div');
    card.className = 'color-card';
    card.setAttribute('role','button');
    card.setAttribute('tabindex','0');
    card.setAttribute('aria-label', `Copy color ${main}`);
    card.style.animationDelay = `${idx*55}ms`;
    card.dataset.value = main;

    card.innerHTML = `
      <div class="color-swatch" style="background:${hex};">
        <div class="copy-hint" style="color:${txtColor};">
          <span class="copy-hint-text"></span>
        </div>
      </div>
      <div class="color-info">
        <div class="color-hex">${hex}</div>
        <div class="color-secondary">${sec}</div>
      </div>
    `;

    card.addEventListener('click', () => copyColor(card, main));
    card.addEventListener('keydown', e => {
      if(e.key==='Enter'||e.key===' ') { e.preventDefault(); copyColor(card, main); }
    });

    paletteGrid.appendChild(card);
  });
}

/* ----------------------------------------------------------------
   COPY TO CLIPBOARD
---------------------------------------------------------------- */
function copyColor(card, value) {
  (navigator.clipboard?.writeText(value) || Promise.reject())
    .then(() => onCopied(card, value))
    .catch(() => {
      const ta=document.createElement('textarea');
      ta.value=value; ta.style.cssText='position:fixed;opacity:0';
      document.body.appendChild(ta); ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      onCopied(card, value);
    });
}

function onCopied(card, value) {
  card.classList.add('copied');
  setTimeout(() => card.classList.remove('copied'), 1600);
  showToast(`Copied  ${value}`);
}

/* ----------------------------------------------------------------
   UI EVENT HANDLERS
---------------------------------------------------------------- */

/* Slider â€” track fill & label */
function updateSlider() {
  const min=+colorSlider.min, max=+colorSlider.max, val=+colorSlider.value;
  colorSlider.style.setProperty('--pct', ((val-min)/(max-min)*100)+'%');
  colorCountLbl.textContent = val;
}
colorSlider.addEventListener('input', updateSlider);
updateSlider(); // initialise

/* Format buttons */
formatBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    formatBtns.forEach(b => { b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
    btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
    currentFormat = btn.dataset.fmt;
    if(palette.length) renderPalette();
  });
});

/* Extract button */
extractBtn.addEventListener('click', extractPalette);

/* File input */
fileInput.addEventListener('change', e => {
  if(e.target.files[0]) loadImageFile(e.target.files[0]);
});

/* Drag & drop */
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop', e => {
  e.preventDefault(); dropZone.classList.remove('drag-over');
  if(e.dataTransfer.files[0]) loadImageFile(e.dataTransfer.files[0]);
});

/* Change image overlay */
changeImgBtn.addEventListener('click', e => { e.stopPropagation(); fileInput.click(); });
changeImgBtn.addEventListener('keydown', e => {
  if(e.key==='Enter') { e.stopPropagation(); fileInput.click(); }
});

/* Clipboard paste (Ctrl+V) */
document.addEventListener('paste', e => {
  const items = e.clipboardData?.items;
  if(!items) return;
  for(const item of items) {
    if(item.type.startsWith('image/')) { loadImageFile(item.getAsFile()); break; }
  }
});
</script>
</body>
</html>